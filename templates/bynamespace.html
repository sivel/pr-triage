{% extends "_base.html" %}
{% block title %}By Namespace - {{ super() }}{% endblock %}
{% block extracss %}
			.btn {
				margin-left: 5px;
				margin-right: 5px;
			}
{% endblock %}
{% block body %}
			<h1>Pull requests by namespace</h1>
			<div>
			A module namespace is defined by the two parent directory names under <code>lib/ansible/modules</code> (or the parent directory when there is only one).
			</div>
			<br>
			<button type="button" class="pull-right btn btn-primary" id="pullsort">Sort by PR Count</button>
			<button type="button" class="pull-right btn btn-primary" id="namesort">Sort by Namespace</button>
			<select class="pull-right form-inline" id="ns_selector">
				<option selected disabled value="default">Select a namespace</option>
{% for namespace in namespaces|sort %}
				<option value="{{ namespace|replace('/', '_') }}">{{ namespace }}</option>
{% endfor %}
			</select>
{% if namespaces %}
			<ul id="topul">
{% for namespace, pulls in namespaces|dictsort %}
				<li id="{{ namespace|replace('/', '_') }}" class="anchor"><strong>{{ namespace }}</strong>&nbsp;<span class="text-muted">({{ pulls|length }})</span>
					<ul>
{% for pull in pulls %}
						<li id="{{ pull.base.repo.full_name }}-{{ pull.number }}" class="pull anchor"><strong class="text-muted">{{ pull.base.repo.full_name }} #{{ pull.number }}</strong>&nbsp;<a href="https://github.com/{{ pull.base.repo.full_name }}/pull/{{ pull.number }}">{{ pull.title }}</a>&nbsp;<span class="text-muted">(<a href="https://github.com/{{ pull.base.repo.full_name }}/pulls/{{ pull.user.login|default(pull.head.user.login) }}">{{ pull.user.login|default(pull.head.user.login) }}</a>)</span></li>
{% endfor %}
					</ul>
				</li>
{% endfor %}
			</ul>
{% endif %}
{% endblock %}
{% block extrajs %}
		<script>
			var countRe = /([0-9]+)/
			$(document).ready(function() {
				$("#pullsort").click(function() {
					var li = $("#topul").children("li");
					li.detach().sort(function(a, b) {
						var aCount = countRe.exec($(a).children('span').text());
						var bCount = countRe.exec($(b).children('span').text());
						return (parseInt(aCount[1]) == parseInt(bCount[1])) ? 0 : (parseInt(aCount[1]) > parseInt(bCount[1])) ? -1 : 1;
					});
					$("#topul").append(li);
					li.filter(":hidden").show();
					$("#ns_selector").val("default");
				});
				$("#namesort").click(function() {location.reload(); $("#ns_selector").val("default");});
				$("#ns_selector").change(function() {
					var ns_selected = $("#ns_selector").find(":selected").val();
					$("#topul").children("li").not("#" + ns_selected).hide();
					$("#topul").children("li#" + ns_selected).show();
				});
			});
		</script>
{% endblock %}
